{
  "request_id": "dev-google-maps-coverage-20260130",
  "timestamp": "2026-01-30T19:30:00Z",
  "priority": "HIGH",
  "objective": "Complete Google Maps skill development following gaode-maps pattern - ensure 100% MCP tool coverage",

  "requirement": {
    "original": "现在开始对google map完成相似的开发，保证所有的协议都正常使用",
    "clarified": "Implement complete Google Maps skill with 100% MCP tool coverage, following the successful gaode-maps development pattern",
    "what": "Complete Google Maps MCP integration with Python scripts",
    "why": "Ensure all Google Maps MCP tools are usable like gaode-maps (12/12 coverage achieved)",
    "where": [
      ".claude/skills/google-maps/scripts/",
      ".claude/skills/google-maps/SKILL.md",
      ".claude/agents/*.md (integration references)"
    ],
    "scope": {
      "included": [
        "List all Google Maps MCP tools",
        "Verify tool name mappings in existing scripts",
        "Fix any tool name mismatches (like gaode-maps BUG-002)",
        "Create list_tools.py for discovery",
        "Test all tools with real API calls",
        "Update SKILL.md with correct usage patterns",
        "Ensure agents reference Google Maps correctly"
      ],
      "excluded": [
        "Google Maps API key management (user provides)",
        "Other skills (gaode-maps already complete)",
        "New feature development (only coverage verification)"
      ]
    },
    "success_criteria": [
      "All Google Maps MCP tools identified and listed",
      "100% tool coverage (N/N where N = total MCP tools)",
      "All tool names match actual MCP server names",
      "list_tools.py script works correctly",
      "All scripts tested and return valid data (with API key)",
      "SKILL.md accurately documents all available tools",
      "Zero 'Unknown tool' errors",
      "Agents correctly reference Google Maps skill"
    ],
    "constraints": [
      "Must follow gaode-maps pattern exactly",
      "Python scripts via Bash tool (not progressive disclosure)",
      "SKILL.md as single source of truth",
      "No hardcoded API keys",
      "Environment variables for credentials"
    ]
  },

  "reference_implementation": {
    "gaode_maps_pattern": {
      "mcp_discovery": "Created list_tools.py to query MCP server",
      "tool_count": "12 tools total",
      "coverage": "12/12 (100%)",
      "bug_pattern": "Tool names assumed without verification (poi_search_keyword vs maps_text_search)",
      "fix_pattern": "Direct MCP query revealed actual tool names, systematic replacement",
      "validation": "Real API tests confirmed all tools work"
    },
    "files_structure": {
      "scripts/list_tools.py": "Query MCP server for available tools",
      "scripts/mcp_client.py": "Base MCP communication class",
      "scripts/<category>.py": "Function implementations (places, routing, weather)",
      "SKILL.md": "Usage documentation with examples",
      "examples/*.md": "Real-world usage examples"
    }
  },

  "context": {
    "codebase_state": {
      "google_maps_exists": true,
      "has_scripts": true,
      "script_count": 4,
      "scripts": [
        "mcp_client.py",
        "places.py",
        "routing.py",
        "weather.py"
      ],
      "current_tools_called": [
        "search_places",
        "compute_routes",
        "lookup_weather"
      ]
    },
    "existing_implementation": {
      "mcp_client_difference": "Uses 'env_vars' parameter instead of 'env' (different from gaode-maps)",
      "tool_calls": {
        "places.py:61": "call_tool('search_places', arguments)",
        "routing.py:82": "call_tool('compute_routes', arguments)",
        "weather.py:53": "call_tool('lookup_weather', arguments)"
      },
      "api_key_handling": "GOOGLE_MAPS_API_KEY environment variable",
      "package_name": "@modelcontextprotocol/server-google-maps"
    },
    "unknown_factors": {
      "actual_mcp_tools": "Need to query MCP server to discover actual tool names",
      "tool_count": "Unknown (gaode had 12, google-maps might differ)",
      "tool_name_matches": "Unknown if search_places/compute_routes/lookup_weather match actual names",
      "missing_tools": "Unknown if there are more tools not yet implemented"
    },
    "gaode_maps_lessons": {
      "bug_found": "Tool names assumed without verification caused 'Unknown tool' errors",
      "fix_applied": "list_tools.py discovered actual names, systematic replacement across all scripts",
      "result": "12/12 coverage, 11/12 tests passed (1 API issue unrelated to tools)",
      "key_insight": "NEVER assume tool names - always verify with MCP server first"
    }
  },

  "development_approach": {
    "strategy": "Follow exact gaode-maps verification pattern",
    "phase_1_discovery": {
      "step_1": "Fix list_tools.py to use 'env_vars' instead of 'env'",
      "step_2": "Query Google Maps MCP server for actual tool list",
      "step_3": "Compare actual tools vs implemented tools",
      "step_4": "Identify gaps (missing tools) and mismatches (wrong names)"
    },
    "phase_2_implementation": {
      "if_gaps_found": "Create new Python scripts for missing tools",
      "if_mismatches_found": "Update tool names like gaode-maps BUG-002 fix",
      "if_all_correct": "Document and validate existing implementation"
    },
    "phase_3_testing": {
      "step_1": "Test each tool with mock/real data",
      "step_2": "Verify JSON output validity",
      "step_3": "Check for 'Unknown tool' errors",
      "step_4": "Document any API-specific issues (like gaode distance API)"
    },
    "phase_4_documentation": {
      "update_skill_md": "Ensure all tools documented with examples",
      "update_agents": "Verify agent references are correct (like gaode-maps cleanup)",
      "create_examples": "Add usage examples for each tool"
    }
  },

  "validation_approach": {
    "tool_discovery": {
      "method": "Run list_tools.py against Google Maps MCP server",
      "expected": "JSON list of all available tools with descriptions and parameters"
    },
    "coverage_check": {
      "method": "Compare MCP tools list vs implemented scripts",
      "formula": "coverage = (implemented_tools / total_mcp_tools) * 100%",
      "target": "100%"
    },
    "tool_name_verification": {
      "method": "Grep actual tool calls in scripts, compare with MCP list",
      "check": "For each call_tool() invocation, verify name exists in MCP tools list"
    },
    "functional_testing": {
      "method": "Execute each script with test inputs (requires API key)",
      "success": "Valid JSON output, no 'Unknown tool' errors",
      "acceptable": "Tool name correct even if API returns error"
    }
  },

  "standards_to_enforce": {
    "no_hardcoded_values": true,
    "use_environment_variables": true,
    "skill_md_single_source": true,
    "agent_references_skill_md": true,
    "python_scripts_via_bash": true,
    "100_percent_coverage": true,
    "tool_names_verified": true
  },

  "related_context": {
    "gaode_maps_success": {
      "completion_report": "docs/dev/gaode-maps-100-percent-coverage-report.md",
      "tool_count": 12,
      "coverage": "100%",
      "agents_integrated": 6,
      "bugs_fixed": 13
    },
    "agent_integration": {
      "transportation": "Uses google-maps for international routes",
      "meals": "Uses google-maps as alternative to gaode in China",
      "accommodation": "Uses google-maps for international hotels",
      "attractions": "Uses google-maps for international attractions",
      "shopping": "Uses google-maps for international shopping",
      "entertainment": "Uses google-maps for international entertainment"
    }
  },

  "deliverables": {
    "required": [
      "list_tools.py (fixed for Google Maps)",
      "Tool coverage analysis report (N/N tools)",
      "Fixed scripts if tool name mismatches found",
      "Updated SKILL.md if needed",
      "Test results for all tools",
      "Integration verification for agents"
    ],
    "reports": [
      "docs/dev/google-maps-coverage-analysis-20260130.md",
      "docs/dev/google-maps-dev-report-20260130.json",
      "docs/dev/google-maps-completion-20260130.md"
    ]
  }
}
